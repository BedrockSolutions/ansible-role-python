---

- block:
    - validate:
        schema:
          type: object
          additionalProperties:
            - command
          properties:
            packages:
              type: array
              items:
                type: string
              default: []
          required:
            - packages
        instance: "{{ os }}"
      register: os_validated

    - set_fact:
        os_v: "{{ os_validated.result }}"

    - name: "Install pip3"
      shell: curl -sS https://bootstrap.pypa.io/get-pip.py | sudo python3
      args:
        creates: /usr/local/bin/pip3
        warn: no

    - name: "Install pip packages"
      pip:
        name: "{{ os_v.packages }}"
        executable: /usr/local/bin/pip3
        extra_args: --upgrade --user
      when: (os_v.packages | length) > 0

  tags:
    - os_pip3
